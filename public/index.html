<!DOCTYPE html>
<html>
<head>
  <title>Auto YouTube Categories</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h2 { margin-top: 40px; }
    .category { display: flex; flex-wrap: wrap; gap: 20px; }
    .video-card {
      background: white;
      width: 300px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 5px #aaa;
      padding-bottom: 10px;
    }
    .video-card img { width: 100%; }
    .video-info { padding: 10px; }
    .video-info small { display: block; color: gray; }
    button { margin-top: 5px; padding: 5px 10px; }
    select { margin-top: 5px; }
  </style>
</head>
<body>

<h1>Trending Videos by Category</h1>

<div id="music">
  <h2>Music</h2>
  <div class="category" id="music-videos"></div>
</div>

<div id="action">
  <h2>Action</h2>
  <div class="category" id="action-videos"></div>
</div>

<div id="drama">
  <h2>Drama</h2>
  <div class="category" id="drama-videos"></div>
</div>

<script>
const categories = ['music', 'action', 'drama'];

categories.forEach(cat => {
  fetch(`/api/category?q=${cat}`)
    .then(res => res.json())
    .then(videos => {
      const container = document.getElementById(`${cat}-videos`);
      videos.forEach(v => {
        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `
          <img src="${v.thumbnail}">
          <div class="video-info">
            <strong>${v.title}</strong>
            <small>Channel: ${v.channel}</small>
            <small>Views: ${v.views}</small>
            <small>Likes: ${v.likes}</small>
            <small>Subscribers: ${v.subscribers}</small>
            <button onclick="loadFormats('${v.videoId}')">Download</button>
            <div id="formats-${v.videoId}"></div>
          </div>
        `;
        container.appendChild(card);
      });
    });
});

function loadFormats(videoId) {
  const url = `https://www.youtube.com/watch?v=${videoId}`;
  fetch(`/api/formats?url=${encodeURIComponent(url)}`)
    .then(res => res.json())
    .then(data => {
      const div = document.getElementById(`formats-${videoId}`);
      div.innerHTML = `
        <label>Download type:</label>
        <select id="type-${videoId}" onchange="renderOptions('${videoId}', '${url}', this.value)">
          <option value="Video">Video</option>
          <option value="Audio">Audio</option>
        </select>
        <div id="options-${videoId}"></div>
      `;
      div.dataset.audio = JSON.stringify(data.audio);
      div.dataset.video = JSON.stringify(data.video);
      renderOptions(videoId, url, 'Video');
    });
}

function renderOptions(videoId, url, type) {
  const div = document.getElementById(`formats-${videoId}`);
  const formats = JSON.parse(div.dataset[type.toLowerCase()]);
  const optionsDiv = document.getElementById(`options-${videoId}`);
  optionsDiv.innerHTML = formats.map(f => {
    const label = f.type === 'Audio' ? `${f.bitrate}kbps` : f.quality;
    return `<a href="/api/download?url=${encodeURIComponent(url)}&itag=${f.itag}" target="_blank">Download ${label}</a>`;
  }).join('<br>');
}
</script>
</body>
</html>
