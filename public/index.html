<!DOCTYPE html>
<html>
<head>
  <title>YouTube Downloader</title>
  <style>
    body { font-family: Arial; background: #222; color: #fff; margin: 0; padding: 20px; }
    h1, h2 { color: #ffd700; }
    input, button, select { padding: 8px; margin: 5px; }
    .video-list { display: flex; flex-wrap: wrap; gap: 20px; }
    .video-card {
      background: #333; border-radius: 10px; overflow: hidden;
      width: 300px; box-shadow: 0 0 5px #000;
    }
    .video-card img { width: 100%; }
    .video-info { padding: 10px; }
    .video-info small { color: #bbb; display: block; }
    .download-options { margin-top: 10px; }
  </style>
</head>
<body>

<h1>YouTube Video Downloader</h1>
<input type="text" id="query" placeholder="Search or paste YouTube URL">
<button onclick="handleSearch()">Search</button>

<div class="video-list" id="videos"></div>

<script>
function handleSearch() {
  const query = document.getElementById('query').value;
  const isUrl = query.includes('youtube.com') || query.includes('youtu.be');

  if (isUrl) {
    displayUrl(query);
  } else {
    fetch(`/api/search?q=${encodeURIComponent(query)}`)
      .then(res => res.json())
      .then(data => renderVideos(data));
  }
}

function displayUrl(url) {
  fetch(`/api/formats?url=${encodeURIComponent(url)}`)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById('videos');
      container.innerHTML = `
        <div class="video-card">
          <div class="video-info">
            <strong>${data.title}</strong>
            <div class="download-options">
              <select id="format">
                ${data.video.map(v => `<option value="${v.itag}">${v.qualityLabel}</option>`).join('')}
              </select>
              <a href="/api/download?url=${encodeURIComponent(url)}&itag=" id="dlBtn" target="_blank">
                <button>Download</button>
              </a>
            </div>
          </div>
        </div>
      `;
      const select = document.getElementById('format');
      select.onchange = () => {
        document.getElementById('dlBtn').href = `/api/download?url=${encodeURIComponent(url)}&itag=${select.value}`;
      };
      select.dispatchEvent(new Event('change'));
    });
}

function renderVideos(videos) {
  const container = document.getElementById('videos');
  container.innerHTML = videos.map(v => `
    <div class="video-card">
      <img src="${v.thumbnail}">
      <div class="video-info">
        <strong>${v.title}</strong>
        <small>${v.channel}</small>
        <small>Views: ${v.views}</small>
        <small>Likes: ${v.likes}</small>
        <button onclick="displayUrl('https://www.youtube.com/watch?v=${v.id}')">Download</button>
      </div>
    </div>
  `).join('');
}

window.onload = () => {
  fetch('/api/search?q=trending')
    .then(res => res.json())
    .then(data => renderVideos(data));
};
</script>
</body>
</html>
